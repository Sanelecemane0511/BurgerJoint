@using System.Text.Json
@using BurgerJoint.Models
@{
    var cart = JsonSerializer.Deserialize<List<OrderItem>>(
        Context.Request.Query["itemsJson"].ToString() ?? "[]") ?? new();
    decimal total = cart.Sum(i => (i.UnitPrice * i.Qty) + (i.AddBeer ? 35 : 0));
}
<div class="container py-4">
    <h2>Your Cart</h2>
    <div class="row g-3">
    @for (int i = 0; i < cart.Count; i++)
    {
        var item = cart[i];
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-0">@item.BurgerName</h6>
                        <small class="text-muted">@item.UnitPrice.ToString("C") each</small>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <button class="btn btn-sm btn-outline-secondary"
                                onclick="updateQty(@i,-1)">-</button>
                        <span class="mx-2">@item.Qty</span>
                        <button class="btn btn-sm btn-outline-secondary"
                                onclick="updateQty(@i,1)">+</button>
                        <button class="btn btn-sm btn-danger"
                                onclick="removeItem(@i)">Remove</button>
                    </div>
                </div>
            </div>
        </div>
    }
    </div>
    <div class="d-flex justify-content-between align-items-center mt-4">
        <span class="fw-bold">Total: @total.ToString("C")</span>
        <a class="btn btn-dark" onclick="goCheckout()">Checkout â†’</a>
    </div>
</div>
<script>
function updateQty(index, delta){
    let cart = JSON.parse(localStorage.getItem('bjCart')||'[]');
    cart[index].Qty = Math.max(1, cart[index].Qty + delta);
    localStorage.setItem('bjCart', JSON.stringify(cart));
    location.reload();
}
function removeItem(index){
    let cart = JSON.parse(localStorage.getItem('bjCart')||'[]');
    cart.splice(index,1);
    localStorage.setItem('bjCart', JSON.stringify(cart));
    location.reload();
}
function goCheckout(){
    const cart = JSON.parse(localStorage.getItem('bjCart')||'[]');
    window.location = '/Order/Order?itemsJson=' + encodeURIComponent(JSON.stringify(cart));
}
</script>